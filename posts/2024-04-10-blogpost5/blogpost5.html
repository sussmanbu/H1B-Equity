<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="team3">
<meta name="dcterms.date" content="2024-04-10">
<meta name="description" content="This blog post will build on blogpost4 to merge the 3rd dataset by case numbers">

<title>MA [46]15 Final Project T3am-3 - blogpost5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">MA [46]15 Final Project T3am-3</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../big_picture.html" rel="" target="">
 <span class="menu-text">H1B workers in US</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../analysis.html" rel="" target="">
 <span class="menu-text">Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">blogpost5</h1>
                  <div>
        <div class="description">
          <p>This blog post will build on blogpost4 to merge the 3rd dataset by case numbers</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>team3 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 10, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">April 10, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.5     ✔ rsample      1.2.0
✔ dials        1.2.0     ✔ tibble       3.2.1
✔ ggplot2      3.4.4     ✔ tidyr        1.3.0
✔ infer        1.0.5     ✔ tune         1.1.2
✔ modeldata    1.2.0     ✔ workflows    1.1.3
✔ parsnip      1.1.1     ✔ workflowsets 1.0.1
✔ purrr        1.0.2     ✔ yardstick    1.2.0
✔ recipes      1.0.9     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ purrr::discard()  masks scales::discard()
✖ dplyr::filter()   masks stats::filter()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Dig deeper into tidy modeling with R at https://www.tmwr.org</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dataset/cleaned_disclosure.rds"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
  CASE_NUMBER     CASE_STATUS RECEIVED_DATE       DECISION_DATE       VISA_CLASS
  &lt;chr&gt;           &lt;chr&gt;       &lt;dttm&gt;              &lt;dttm&gt;              &lt;chr&gt;     
1 I-200-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 H-1B      
2 I-203-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 E-3 Austr…
3 I-200-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 H-1B      
4 I-200-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 H-1B      
5 I-200-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 H-1B      
6 I-200-23355-58… Certified   2023-12-21 00:00:00 2023-12-29 00:00:00 H-1B      
# ℹ 7 more variables: JOB_TITLE &lt;chr&gt;, FULL_TIME_POSITION &lt;chr&gt;,
#   BEGIN_DATE &lt;dttm&gt;, END_DATE &lt;dttm&gt;, EMPLOYER_NAME &lt;chr&gt;,
#   EMPLOYER_STATE &lt;chr&gt;, AGENT_REPRESENTING_EMPLOYER &lt;chr&gt;</code></pre>
</div>
</div>
<section id="combining-dataset" class="level1">
<h1>Combining Dataset</h1>
<p>We selected this dataset, updated in 2024, because it comprehensively represents the evolution of U.S. immigration policy from the Trump to the Biden administration. It provides a wealth of columns suitable for statistical modeling. To enrich our analysis, we plan to merge it with two other datasets. The first includes information on the applicants’ universities and majors, while the second contains data on their incomes, allowing us to construct a linear regression model. Once merged, we will have a dataframe with approximately 30+ columns.</p>
<p>This is the line of code of how to read xlsx files and convert into rds. We commented out after done</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rds for the other two projects</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df2 &lt;- read_excel("dataset/worksite.xlsx")</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(df2, "dataset/LCA_worksite.rds")</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df3 &lt;- read_excel("dataset/appendix.xlsx")</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(df3, "dataset/LCA_appendix.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in df2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dataset/LCA_worksite.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in df3</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dataset/appendix.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="merging-process" class="level2">
<h2 class="anchored" data-anchor-id="merging-process">Merging Process</h2>
<p>To merge the dataset together, we can find matching case numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge df1 and df2 by case number</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># merge_1 &lt;- merge(df, df2, by="CASE_NUMBER", all = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># final_merge &lt;- merge(merge_1, df3, by="CASE_NUMBER", all = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize our new dataset</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># final_merge</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save as new rds for final_merge</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(final_merge, "dataset/final_merge.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-background" class="level1">
<h1>Data Background</h1>
<p>This is the dataset we are combining.. How are you combining them</p>
</section>
<section id="start-here---import-data" class="level1">
<h1>Start HERE - Import Data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># just load in this dataset</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dataset/final_merge.rds"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         CASE_NUMBER           CASE_STATUS RECEIVED_DATE DECISION_DATE
1 I-200-19297-106681 Certified - Withdrawn    2019-10-24    2023-11-01
2 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
3 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
4 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
5 I-200-19319-149308 Certified - Withdrawn    2019-11-15    2023-10-05
6 I-200-19323-154281 Certified - Withdrawn    2019-11-19    2023-10-02
  VISA_CLASS                JOB_TITLE FULL_TIME_POSITION BEGIN_DATE   END_DATE
1       H-1B     Research Scientist I                  Y 2019-10-24 2022-10-23
2       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
3       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
4       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
5       H-1B       Software Developer                  Y 2019-11-18 2022-11-17
6       H-1B SENIOR SOFTWARE ENGINEER                  Y 2020-05-16 2023-05-15
                       EMPLOYER_NAME EMPLOYER_STATE AGENT_REPRESENTING_EMPLOYER
1    Georgia Institute of Technology             GA                          No
2                     TRISHULLA, LLC             WI                         Yes
3                     TRISHULLA, LLC             WI                         Yes
4                     TRISHULLA, LLC             WI                         Yes
5 INTERNATIONAL SOFTWARE SYSTEMS INC             MD                          No
6            UBER TECHNOLOGIES, INC.             CA                         Yes
  WORKSITE_WORKERS SECONDARY_ENTITY SECONDARY_ENTITY_BUSINESS_NAME
1                1                N                           &lt;NA&gt;
2                1                Y           Acuity Eyecare Group
3                1                N                           &lt;NA&gt;
4                1                N                           &lt;NA&gt;
5                1                N                           &lt;NA&gt;
6                1                N                           &lt;NA&gt;
                     WORKSITE_ADDRESS1 WORKSITE_ADDRESS2 WORKSITE_CITY
1                      313 Ferst Drive              &lt;NA&gt;       Atlanta
2 4835 Lyndon B Johnson Fwy, Suite 850              &lt;NA&gt;        Dallas
3       6629 UNIVERSITY AVE, SUITE 210              &lt;NA&gt;     MIDDLETON
4       8383 Greenway Blvd., Suite 600              &lt;NA&gt;     Middleton
5                 7337 Hanover Parkway           Suite A     Greenbelt
6                   1455 MARKET STREET         4TH FLOOR SAN FRANCISCO
  WORKSITE_COUNTY WORKSITE_STATE WORKSITE_POSTAL_CODE WAGE_RATE_OF_PAY_FROM
1          FULTON        GEORGIA                30332                 52100
2          DALLAS          TEXAS                75244                 77605
3            DANE      WISCONSIN                53562                 77605
4            DANE      WISCONSIN                53562                 77605
5 PRINCE GEORGE'S       MARYLAND                20770                 76000
6   SAN FRANCISCO     CALIFORNIA                94103                202442
  WAGE_RATE_OF_PAY_TO WAGE_UNIT_OF_PAY PREVAILING_WAGE PW_UNIT_OF_PAY
1                  NA             Year           46821           Year
2               77700             Year           77605           Year
3               77700             Year           65458           Year
4               77700             Year           65458           Year
5                  NA             Year           75712           Year
6                  NA             Year          168958           Year
  PW_TRACKING_NUMBER PW_WAGE_LEVEL          PW_OES_YEAR PW_OTHER_SOURCE
1               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
2               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
3               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
4               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
5               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
6               &lt;NA&gt;            IV 7/1/2019 - 6/30/2020            &lt;NA&gt;
  PW_OTHER_YEAR PW_SURVEY_PUBLISHER PW_SURVEY_NAME APPX_A_NO_OF_EXEMPT_WORKERS
1            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
2            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
3            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
4            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
5            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
6            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
  APPX_A_NAME_OF_INSTITUTION APPX_A_FIELD_OF_STUDY APPX_A_DATE_OF_DEGREE
1                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
2                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
3                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
4                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
5                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
6                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;</code></pre>
</div>
</div>
</section>
<section id="exploration-data-analysis" class="level1">
<h1>Exploration Data Analysis</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract year from date</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>YEAR_RECEIVED <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(final_df<span class="sc">$</span>RECEIVED_DATE, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>MONTH_RECEIVED <span class="ot">=</span> <span class="fu">month</span>(final_df<span class="sc">$</span>RECEIVED_DATE)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>DAY_RECEIVED <span class="ot">=</span> <span class="fu">day</span>(final_df<span class="sc">$</span>RECEIVED_DATE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s do the same for the remainder date columns</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>YEAR_END <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(final_df<span class="sc">$</span>END_DATE, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>MONTH_END <span class="ot">=</span> <span class="fu">month</span>(final_df<span class="sc">$</span>END_DATE)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>DAY_END <span class="ot">=</span> <span class="fu">day</span>(final_df<span class="sc">$</span>END_DATE)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>YEAR_DECISION <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(final_df<span class="sc">$</span>DECISION_DATE, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>MONTH_DECISION <span class="ot">=</span> <span class="fu">month</span>(final_df<span class="sc">$</span>DECISION_DATE)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>DAY_DECISION <span class="ot">=</span> <span class="fu">day</span>(final_df<span class="sc">$</span>DECISION_DATE)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>YEAR_BEGIN <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">substr</span>(final_df<span class="sc">$</span>BEGIN_DATE, <span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>MONTH_BEGIN <span class="ot">=</span> <span class="fu">month</span>(final_df<span class="sc">$</span>BEGIN_DATE)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>final_df<span class="sc">$</span>DAY_BEGIN <span class="ot">=</span> <span class="fu">day</span>(final_df<span class="sc">$</span>BEGIN_DATE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         CASE_NUMBER           CASE_STATUS RECEIVED_DATE DECISION_DATE
1 I-200-19297-106681 Certified - Withdrawn    2019-10-24    2023-11-01
2 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
3 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
4 I-200-19319-148860 Certified - Withdrawn    2019-11-15    2023-10-20
5 I-200-19319-149308 Certified - Withdrawn    2019-11-15    2023-10-05
6 I-200-19323-154281 Certified - Withdrawn    2019-11-19    2023-10-02
  VISA_CLASS                JOB_TITLE FULL_TIME_POSITION BEGIN_DATE   END_DATE
1       H-1B     Research Scientist I                  Y 2019-10-24 2022-10-23
2       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
3       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
4       H-1B       Software Developer                  Y 2019-12-01 2022-11-30
5       H-1B       Software Developer                  Y 2019-11-18 2022-11-17
6       H-1B SENIOR SOFTWARE ENGINEER                  Y 2020-05-16 2023-05-15
                       EMPLOYER_NAME EMPLOYER_STATE AGENT_REPRESENTING_EMPLOYER
1    Georgia Institute of Technology             GA                          No
2                     TRISHULLA, LLC             WI                         Yes
3                     TRISHULLA, LLC             WI                         Yes
4                     TRISHULLA, LLC             WI                         Yes
5 INTERNATIONAL SOFTWARE SYSTEMS INC             MD                          No
6            UBER TECHNOLOGIES, INC.             CA                         Yes
  WORKSITE_WORKERS SECONDARY_ENTITY SECONDARY_ENTITY_BUSINESS_NAME
1                1                N                           &lt;NA&gt;
2                1                Y           Acuity Eyecare Group
3                1                N                           &lt;NA&gt;
4                1                N                           &lt;NA&gt;
5                1                N                           &lt;NA&gt;
6                1                N                           &lt;NA&gt;
                     WORKSITE_ADDRESS1 WORKSITE_ADDRESS2 WORKSITE_CITY
1                      313 Ferst Drive              &lt;NA&gt;       Atlanta
2 4835 Lyndon B Johnson Fwy, Suite 850              &lt;NA&gt;        Dallas
3       6629 UNIVERSITY AVE, SUITE 210              &lt;NA&gt;     MIDDLETON
4       8383 Greenway Blvd., Suite 600              &lt;NA&gt;     Middleton
5                 7337 Hanover Parkway           Suite A     Greenbelt
6                   1455 MARKET STREET         4TH FLOOR SAN FRANCISCO
  WORKSITE_COUNTY WORKSITE_STATE WORKSITE_POSTAL_CODE WAGE_RATE_OF_PAY_FROM
1          FULTON        GEORGIA                30332                 52100
2          DALLAS          TEXAS                75244                 77605
3            DANE      WISCONSIN                53562                 77605
4            DANE      WISCONSIN                53562                 77605
5 PRINCE GEORGE'S       MARYLAND                20770                 76000
6   SAN FRANCISCO     CALIFORNIA                94103                202442
  WAGE_RATE_OF_PAY_TO WAGE_UNIT_OF_PAY PREVAILING_WAGE PW_UNIT_OF_PAY
1                  NA             Year           46821           Year
2               77700             Year           77605           Year
3               77700             Year           65458           Year
4               77700             Year           65458           Year
5                  NA             Year           75712           Year
6                  NA             Year          168958           Year
  PW_TRACKING_NUMBER PW_WAGE_LEVEL          PW_OES_YEAR PW_OTHER_SOURCE
1               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
2               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
3               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
4               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
5               &lt;NA&gt;             I 7/1/2019 - 6/30/2020            &lt;NA&gt;
6               &lt;NA&gt;            IV 7/1/2019 - 6/30/2020            &lt;NA&gt;
  PW_OTHER_YEAR PW_SURVEY_PUBLISHER PW_SURVEY_NAME APPX_A_NO_OF_EXEMPT_WORKERS
1            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
2            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
3            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
4            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
5            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
6            NA                &lt;NA&gt;           &lt;NA&gt;                          NA
  APPX_A_NAME_OF_INSTITUTION APPX_A_FIELD_OF_STUDY APPX_A_DATE_OF_DEGREE
1                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
2                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
3                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
4                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
5                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
6                       &lt;NA&gt;                  &lt;NA&gt;                  &lt;NA&gt;
  YEAR_RECEIVED MONTH_RECEIVED DAY_RECEIVED YEAR_END MONTH_END DAY_END
1          2019             10           24     2022        10      23
2          2019             11           15     2022        11      30
3          2019             11           15     2022        11      30
4          2019             11           15     2022        11      30
5          2019             11           15     2022        11      17
6          2019             11           19     2023         5      15
  YEAR_DECISION MONTH_DECISION DAY_DECISION YEAR_BEGIN MONTH_BEGIN DAY_BEGIN
1          2023             11            1       2019          10        24
2          2023             10           20       2019          12         1
3          2023             10           20       2019          12         1
4          2023             10           20       2019          12         1
5          2023             10            5       2019          11        18
6          2023             10            2       2020           5        16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(final_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CASE_NUMBER"                    "CASE_STATUS"                   
 [3] "RECEIVED_DATE"                  "DECISION_DATE"                 
 [5] "VISA_CLASS"                     "JOB_TITLE"                     
 [7] "FULL_TIME_POSITION"             "BEGIN_DATE"                    
 [9] "END_DATE"                       "EMPLOYER_NAME"                 
[11] "EMPLOYER_STATE"                 "AGENT_REPRESENTING_EMPLOYER"   
[13] "WORKSITE_WORKERS"               "SECONDARY_ENTITY"              
[15] "SECONDARY_ENTITY_BUSINESS_NAME" "WORKSITE_ADDRESS1"             
[17] "WORKSITE_ADDRESS2"              "WORKSITE_CITY"                 
[19] "WORKSITE_COUNTY"                "WORKSITE_STATE"                
[21] "WORKSITE_POSTAL_CODE"           "WAGE_RATE_OF_PAY_FROM"         
[23] "WAGE_RATE_OF_PAY_TO"            "WAGE_UNIT_OF_PAY"              
[25] "PREVAILING_WAGE"                "PW_UNIT_OF_PAY"                
[27] "PW_TRACKING_NUMBER"             "PW_WAGE_LEVEL"                 
[29] "PW_OES_YEAR"                    "PW_OTHER_SOURCE"               
[31] "PW_OTHER_YEAR"                  "PW_SURVEY_PUBLISHER"           
[33] "PW_SURVEY_NAME"                 "APPX_A_NO_OF_EXEMPT_WORKERS"   
[35] "APPX_A_NAME_OF_INSTITUTION"     "APPX_A_FIELD_OF_STUDY"         
[37] "APPX_A_DATE_OF_DEGREE"          "YEAR_RECEIVED"                 
[39] "MONTH_RECEIVED"                 "DAY_RECEIVED"                  
[41] "YEAR_END"                       "MONTH_END"                     
[43] "DAY_END"                        "YEAR_DECISION"                 
[45] "MONTH_DECISION"                 "DAY_DECISION"                  
[47] "YEAR_BEGIN"                     "MONTH_BEGIN"                   
[49] "DAY_BEGIN"                     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's check missing values</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(final_df)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   CASE_NUMBER                    CASE_STATUS 
                             0                              0 
                 RECEIVED_DATE                  DECISION_DATE 
                             0                              0 
                    VISA_CLASS                      JOB_TITLE 
                             0                              0 
            FULL_TIME_POSITION                     BEGIN_DATE 
                             0                              0 
                      END_DATE                  EMPLOYER_NAME 
                             0                              0 
                EMPLOYER_STATE    AGENT_REPRESENTING_EMPLOYER 
                            30                              0 
              WORKSITE_WORKERS               SECONDARY_ENTITY 
                             0                              0 
SECONDARY_ENTITY_BUSINESS_NAME              WORKSITE_ADDRESS1 
                        119355                              0 
             WORKSITE_ADDRESS2                  WORKSITE_CITY 
                        100154                              0 
               WORKSITE_COUNTY                 WORKSITE_STATE 
                            38                              0 
          WORKSITE_POSTAL_CODE          WAGE_RATE_OF_PAY_FROM 
                           588                              0 
           WAGE_RATE_OF_PAY_TO               WAGE_UNIT_OF_PAY 
                        101101                              0 
               PREVAILING_WAGE                 PW_UNIT_OF_PAY 
                             0                              0 
            PW_TRACKING_NUMBER                  PW_WAGE_LEVEL 
                        149453                          10947 
                   PW_OES_YEAR                PW_OTHER_SOURCE 
                         10947                         138906 
                 PW_OTHER_YEAR            PW_SURVEY_PUBLISHER 
                        138906                         140499 
                PW_SURVEY_NAME    APPX_A_NO_OF_EXEMPT_WORKERS 
                        140499                         149535 
    APPX_A_NAME_OF_INSTITUTION          APPX_A_FIELD_OF_STUDY 
                        149535                         149535 
         APPX_A_DATE_OF_DEGREE                  YEAR_RECEIVED 
                        149535                              0 
                MONTH_RECEIVED                   DAY_RECEIVED 
                             0                              0 
                      YEAR_END                      MONTH_END 
                             0                              0 
                       DAY_END                  YEAR_DECISION 
                             0                              0 
                MONTH_DECISION                   DAY_DECISION 
                             0                              0 
                    YEAR_BEGIN                    MONTH_BEGIN 
                             0                              0 
                     DAY_BEGIN 
                             0 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(final_df[<span class="st">"FULL_TIME_POSITION"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    FULL_TIME_POSITION
1                    Y
386                  N</code></pre>
</div>
</div>
<section id="employment-trends" class="level3">
<h3 class="anchored" data-anchor-id="employment-trends">Employment Trends</h3>
<p>What are some most common jobs titles, industries, or the duration of employment contracts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the dataset which jobs have most frequency and applicant get full time position</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> final_df <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FULL_TIME_POSITION <span class="sc">==</span> <span class="st">"Y"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(JOB_TITLE, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by n</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(filtered_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 JOB_TITLE    n
1        Software Engineer 8481
2       Software Developer 5442
3 Senior Software Engineer 2260
4       SOFTWARE DEVELOPER 1723
5      Assistant Professor 1183</code></pre>
</div>
</div>
<p>This is the most frequent job titles appear in the dataset. From this result, we can see that tech related jobs are still the highest percentage of strong hire in United States.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the dataset which jobs have most frequency and applicant get full time position</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> final_df <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(EMPLOYER_NAME, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Selecting by n</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(filtered_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           EMPLOYER_NAME    n
1                Amazon.com Services LLC 3259
2                 Ernst &amp; Young U.S. LLP 2610
3                             Google LLC 2325
4                  Microsoft Corporation 2190
5 COGNIZANT TECHNOLOGY SOLUTIONS US CORP 1639</code></pre>
</div>
</div>
<p>Big companies has always mass hire workers since they have more budget. It is no surprise to see Amazon to be at top.</p>
<p>case status</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>case_df <span class="ot">&lt;-</span> final_df <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(CASE_STATUS) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(case_df, <span class="fu">aes</span>(<span class="at">x =</span> CASE_STATUS, <span class="at">y =</span> percent, <span class="at">fill =</span> CASE_STATUS)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, percent)), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Case Status"</span>, <span class="at">title =</span> <span class="st">"Distribution of CASE_STATUS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="blogpost5_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Looking at the plot, it might not be suitable to build a classifier to predict labels since it is high imbalance. What does each label mean?</p>
<p>When application is certified, it allows the employer to proceed with next steps of the visa process, which include petitioning U.S. Citizenship and Immigration Services (USCIS) for a visa on behalf of the foreign worker.</p>
<p>We also notice a 9% certified - withdrawn. In other word, this is saying the application is approved but employer chose to withdraw it before foreign worker began employment. This can happen due to several reason.</p>
<p>Company’s budget cut</p>
<p>candidate issues - candidate might accepted job offers elsewhere</p>
<p>Next, we will observe fulltime position.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>case_df <span class="ot">&lt;-</span> final_df <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(FULL_TIME_POSITION) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(case_df, <span class="fu">aes</span>(<span class="at">x =</span> FULL_TIME_POSITION, <span class="at">y =</span> percent, <span class="at">fill =</span> FULL_TIME_POSITION)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, percent)), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"FULL_TIME_POSITION"</span>, <span class="at">title =</span> <span class="st">"Distribution of FULL_TIME_POSITION"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="blogpost5_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Again, we see that highly imbalance target labels. Remember that employers who are seeking to hire foreign workers must submit various forms of applications. Those candidates who received full time positions from employers are considered strong candidates which is why employers are willing to submit applications to OFLC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify states with high number of applicants or high approval rates</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> final_df</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>state_df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(state_df[<span class="fu">c</span>(<span class="st">"EMPLOYER_STATE"</span>, <span class="st">"CASE_STATUS"</span>)])</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>state_data <span class="ot">&lt;-</span> state_df <span class="sc">|&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EMPLOYER_STATE) <span class="sc">|&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Applications =</span> <span class="fu">n</span>(),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Approved_Applications =</span> <span class="fu">sum</span>(CASE_STATUS <span class="sc">==</span> <span class="st">"Approved"</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by total applications</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>state_data_sorted_applicants <span class="ot">&lt;-</span> state_data <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Applications))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>top_states <span class="ot">&lt;-</span> state_data_sorted_applicants <span class="sc">|&gt;</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">20</span>, Total_Applications)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizing</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for Total Applications</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_states, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(EMPLOYER_STATE, <span class="sc">-</span>Total_Applications), <span class="at">y =</span> Total_Applications)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"GREY"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)) <span class="sc">+</span>  <span class="co"># Smaller text size for states</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Visa Applications by State"</span>, <span class="at">x =</span> <span class="st">"State"</span>, <span class="at">y =</span> <span class="st">"Number of Applications"</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()  <span class="co"># Flips the coordinates to make labels readable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="blogpost5_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Top 20 states where received the highest number of applications. Now you know what states to look for jobs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mydata=PERM_Disclosure_Data_FY2018_EOY</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(123)</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 1% of the data</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mydata &lt;- mydata[sample(nrow(mydata), size = 0.01 * nrow(mydata)), ]</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># status_counts &lt;- mydata %&gt;% count(CASE_STATUS)</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(status_counts, aes(x = "", y = n, fill = CASE_STATUS)) +</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_bar(width = 1, stat = "identity") +</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coord_polar(theta = "y") +</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_void() +</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># labs(fill = "Case Status", title = "Distribution of CASE_STATUS")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lm_result &lt;- lm(data_dif ~ PW_AMOUNT_9089, data = mydata)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(lm_result)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clustering-analysis" class="level3">
<h3 class="anchored" data-anchor-id="clustering-analysis">Clustering Analysis</h3>
<p>We can make use of various clustering techniques to group similar applicants together.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> final_df <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(JOB_TITLE %in% c("Software Engineer", "Assistant Professor", "Business Analyst", "Machine Learning Engineer"),</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># FULL_TIME_POSITION %in% c("Y", "N")) %&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(WAGE_RATE_OF_PAY_FROM, PREVAILING_WAGE)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtered_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  WAGE_RATE_OF_PAY_FROM PREVAILING_WAGE
1                 52100           46821
2                 77605           77605
3                 77605           65458
4                 77605           65458
5                 76000           75712
6                202442          168958</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create recipe</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(<span class="sc">~</span> ., <span class="at">data=</span>filtered_df) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="ot">&lt;-</span> <span class="fu">bake</span>(rec, <span class="at">new_data=</span><span class="cn">NULL</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># perform clustering</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>clustered_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(cluster_data, <span class="at">centers=</span>k)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize cluster</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>filtered_df<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">factor</span>(clustered_result<span class="sc">$</span>cluster)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtered_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  WAGE_RATE_OF_PAY_FROM PREVAILING_WAGE cluster
1                 52100           46821       3
2                 77605           77605       3
3                 77605           65458       3
4                 77605           65458       3
5                 76000           75712       3
6                202442          168958       4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_df, <span class="fu">aes</span>(<span class="at">x =</span> WAGE_RATE_OF_PAY_FROM, <span class="at">y =</span> PREVAILING_WAGE)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_wrap(~ cluster) +</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Wage Rate vs. Prevailing Wage by Cluster"</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="blogpost5_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="observation-and-limitation" class="level1">
<h1>Observation and Limitation</h1>
<p>WAGE_RATE_OF_PAY_FROM is the minimum wage pay at the worksite,</p>
<p>PREVAILING_WAGE is the average wage paid to similar employed workers in the field</p>
<p>Looking at the result of KMeans with only two numerical columns, it was not necessary to make use of Kmeans because is obvious to notice a linear relationship. There’s a positive correlation between these two features. It is expected that employers are pay more at the worksite than prevailng wages.</p>
<p>For example, applicants who are highly specialized / high demand positions mostly lie in cluster 4.</p>
<p>To recall, one limitation of this KMeans is the choice of cluster, k, and limited numerical columns to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>yearly_wage <span class="ot">&lt;-</span> final_df <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR_BEGIN) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_Prevailing_Wage =</span> <span class="fu">mean</span>(PREVAILING_WAGE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yearly_wage, <span class="fu">aes</span>(<span class="at">x =</span> YEAR_BEGIN, <span class="at">y =</span> Avg_Prevailing_Wage)) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>  <span class="co"># Use a line plot to show trends over time</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>  <span class="co"># Add points to highlight each year's average wage</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Average Prevailing Wage Per Year"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Prevailing Wage"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="blogpost5_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>we see a sharp drop in year 2021 due to COVID-19.</p>
</section>
<section id="whats-next" class="level1">
<h1>What’s Next</h1>
<section id="build-on-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="build-on-logistic-regression">Build on Logistic Regression</h3>
<p>This time with more features/columns, we can build a better logistic regression model to predict approved or denial</p>
</section>
<section id="linear-regression-on-income" class="level3">
<h3 class="anchored" data-anchor-id="linear-regression-on-income">Linear Regression on income</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>